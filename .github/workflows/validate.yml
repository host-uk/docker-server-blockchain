name: Validate

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  validate-compose:
    name: Validate Docker Compose
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Set up Docker
        uses: docker/setup-buildx-action@v3

      - name: Create .env file
        run: cp .env.example .env

      - name: Validate production compose
        run: docker compose -f docker-compose.yaml config --quiet

      - name: Validate development compose
        run: docker compose -f docker-compose.yaml -f docker-compose.dev.yml config --quiet

      - name: Validate Coolify compose
        run: |
          # Create dummy Coolify variables
          export SERVICE_FQDN_BTCPAYSERVER=btcpay.example.com
          export SERVICE_PASSWORD_POSTGRES=testpassword
          export SERVICE_USER_BITCOIN=testuser
          export SERVICE_PASSWORD_BITCOIN=testpassword
          docker compose -f docker-compose.coolify.yaml config --quiet

  lint-yaml:
    name: Lint YAML
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Lint YAML files
        uses: ibiqlik/action-yamllint@v3
        with:
          file_or_dir: .
          config_data: |
            extends: default
            rules:
              line-length:
                max: 200
              truthy:
                allowed-values: ['true', 'false', 'yes', 'no']
